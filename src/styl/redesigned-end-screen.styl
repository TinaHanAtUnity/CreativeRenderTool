@import "vars.styl";
@import "components.styl";
@import "gdpr-pop-up.styl";
@import "square-end-screen.styl";

// We have new media queries with custom font sizes for the endscreen so we need to use 'em' unit

$redesigned-end-screen-mixin($scale-size = $default-scale-size) {
  #redesigned-end-screen {
    background-color: $end-screen-background-color;

    .btn-close-region {
      $close-button-default($scale-size);
      top: -.5 * $endscreen-default-size;
      right: 0;
      padding: $scale-size * $default-size * .25;
    }

    .china-advertisement {
      $china-overlay($default-scale-size);
      position: absolute;
      right: 0;
      bottom: 0;
      z-index: 10;
      margin-right: .5 * $endscreen-default-size;
      padding: 0;
      color: $gray;
      font-size: $endscreen-default-size * .6;
      opacity: .6;
    }

    .pop-up-container {
      margin: .75 * $endscreen-default-size 1 * $endscreen-default-size;
      width: "calc(100% - 2 * %s)" % $endscreen-default-size;
      height: "calc(100% - 1.5 * %s)" % $endscreen-default-size;
      border-radius: .75 * $endscreen-default-size;
      box-shadow: 0 4px 14px rgba(0, 0, 0, .5);
    }

    .download-container {
      margin: .75 * $default-scale-size * $scale-size auto 0 auto;
      padding: $endscreen-default-size * .6 0;
      width: $endscreen-default-size * 11.2;
      border-radius: $endscreen-default-size * .6;
      background: $blue;
      color: $white;
      text-align: center;
      font-size: $endscreen-default-size;
    }

    .download-message-container {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .game-rating {
      $game-rating-default($scale-size);
      margin-top: .41 * $endscreen-default-size;
      letter-spacing: 0;
      font-size: .8 * $endscreen-default-size;
    }

    .game-rating-stars-top {
      $game-rating-mask-default($scale-size);
      position: absolute;
      left: 0;
      z-index: 1;
    }

    .game-rating-stars-bottom {
      z-index: 0;
    }

    .game-rating-count {
      $game-rating-count-default($scale-size);
      font-size: .5 * $endscreen-default-size;
    }

    .game-icon {
      left: "calc(50% - (3.5 * %s)/2)" % $endscreen-default-size;
      min-width: 3.5 * $endscreen-default-size;
      min-height: 3.5 * $endscreen-default-size;
      width: 3.5 * $endscreen-default-size;
      height: 3.5 * $endscreen-default-size;
      border-radius: .4 * $endscreen-default-size;
      background-position: center;
      background-size: cover;
      background-repeat: no-repeat;
    }

    .icon-star {
      margin-left: -.25 * $endscreen-default-size;
    }

    .first-icon-star {
      margin-left: 0;
    }

    .icon-star:before {
      font-size: .8 * $endscreen-default-size;
    }

    .unityads-logo {
      $unityads-logo-default($scale-size, false);
      position: absolute;
      z-index: 10;
      margin-bottom: 3px;
      height: 18px;
      opacity: .6;
    }

    .name-container {
      $name-container-default($scale-size);
      max-width: 90%;
      color: $end-screen-game-name-color;
      text-align: center;
      font-size: 1 * $endscreen-default-size;
    }

    .bottom-container {
      position: absolute;
      bottom: 0;
      left: 0;
      margin-bottom: .15 * $endscreen-default-size;
      width: 100%;
      height: 1.35 * $endscreen-default-size;
    }

    .privacy-button {
      $privacy-button-default($scale-size);
      left: 0;
      z-index: 15;
      margin-left: .5 * $endscreen-default-size;
      line-height: initial;
    }

    .icon-gdpr {
      color: $black;
      font-size: 17px;
      opacity: .25;
    }

    &.show-gdpr-banner .gdpr-pop-up {
      $gdpr-pop-up($scale-size);
    }

    &:not(.show-gdpr-banner) {
      .gdpr-pop-up {
        display: none;
      }
    }

    .game-background-container {
      position: relative;
      width: 100%;
      height: 69%;
    }

    .game-background {
      width: 100%;
      height: 100%;
    }

    .game-background-portrait {
      border-radius: .75 * $endscreen-default-size .75 * $endscreen-default-size 0 0;
    }

    .game-background-landscape {
      border-radius: .75 * $endscreen-default-size 0 0 .75 * $endscreen-default-size;
    }

    .column-container {
      display: flex;
      flex: 1;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin-top: 1 * $endscreen-default-size;
      margin-bottom: .85 * $endscreen-default-size;
    }

    .game-background-portrait {
      display: block;
    }

    .game-background-landscape {
      display: none;
    }

    .row-container {
      bottom: $endscreen-default-size;
      display: flex;
      flex-direction: row;
      justify-content: center;
    }

    .store-container {
      margin-top: 0;
    }

    .end-screen-info-background {
      width: 100%;
      height: 31%;
      border-radius: 0 0 .75 * $endscreen-default-size .75 * $endscreen-default-size;
    }

    .game-icon {
      align-self: center;
    }

    .game-background {
      background-color: $end-screen-gray-border;
    }

    .btn-close-region {
      top: -.3 * $endscreen-default-size;
      right: .3 * $endscreen-default-size;
    }
  }

  body {
    &.portrait #redesigned-end-screen {
      .campaign-container {
        background-color: transparent;
      }

      .pop-up-container {
        height: calc(100% - 2.5em);
      }

      .game-background-blurred {
        height: 65%;
      }

      .game-image {
        border-radius: 1 * $endscreen-default-size 1 * $endscreen-default-size 0 0;
      }

      .game-icon {
        position: absolute;
        top: -1.5 * $endscreen-default-size;
      }

      .end-screen-info-background {
        border-radius: 0 0 .75 * $endscreen-default-size .75 * $endscreen-default-size;
      }

      .download-container {
        margin: 1 * $endscreen-default-size auto 0 auto;
      }

      .column-container {
        margin-bottom: 0;
      }

      .gdpr-pop-up {
        opacity: .9;
      }

      @media (max-height: 460px) {
        .pop-up-container {
          height: "calc(100% - 3.55 * %s)" % $endscreen-default-size;

          .icon-close {
            font-size: 1.5 * $endscreen-default-size;
          }

          .btn-close-region {
            top: -.5 * $endscreen-default-size;
            right: -.3 * $endscreen-default-size;
          }
        }

        .bottom {
          height: 2.05 * $endscreen-default-size;
        }
      }
    }

    &.landscape #redesigned-end-screen {
      .btn-close-region {
        color: $gray;
      }

      .end-screen-info {
        .download-container  {
          margin: 1 * $endscreen-default-size auto 0 auto;
        }

        .game-icon {
          margin-bottom: .8 * $endscreen-default-size;
        }
      }

      .bottom-container {
        right: 1 * $endscreen-default-size;
        bottom: .75 * $endscreen-default-size;
        left: auto;
        width: "calc(50% - 1 * %s)" % $endscreen-default-size;
      }

      .game-background-container {
        width: 50%;
        height: 100%;
      }

      .game-background-portrait {
        display: none;
      }
      .game-background-landscape {
        display: block;
      }

      .end-screen-info {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }

      .campaign-container {
        display: flex;
        border-radius: .75 * $endscreen-default-size;
      }

      .end-screen-info-background {
        width: 50%;
        height: 100%;
        border-radius: 0 .75 * $endscreen-default-size .75 * $endscreen-default-size 0;
        text-align: center;
      }

      .gdpr-pop-up {
        left: 0;
      }
    }

    &.ios {
      #redesigned-end-screen .end-screen-info {
        .game-icon {
          border-radius: .8 * $endscreen-default-size;
        }

        .download-container {
          border-radius: .6 * $endscreen-default-size;
        }
      }
    }

    &.landscape #redesigned-end-screen {
      .end-screen-info {
        .download-container  {
          margin: 1 * $endscreen-default-size auto 0 auto;
        }
      }
    }
  }
}

#redesigned-end-screen {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: transparent;

  .campaign-container {
    position: relative;
    width: 100%;
    height: 100%;
    border-radius: .75 * $endscreen-default-size;
    background: $white;
  }

  .game-background {
    background-color: $black;
    background-position: center;
    background-size: cover;
    background-repeat: no-repeat;
  }

  &.show-gdpr-banner {
    .privacy-button {
      display: none;
    }
  }

  .end-screen-info-background {
    position: relative;
    display: flex;
    flex: 1;
    flex-direction: column;
    align-items: center;
    align-content: center;
    height: 100%;
    justify-content: center;
    background-color: $end-screen-background-color;
  }

  .bottom-container,
  .pop-up-container {
    @media (orientation: portrait) {
      @media (max-height: 380px) {
        .icon-gdpr {
          font-size: 11px;
        }

        .unityads-logo {
          height: 11px;
        }
      }

      @media (max-height: 600px) {
        .icon-gdpr {
          font-size: 13px;
        }

        .unityads-logo {
          height: 13px;
        }
      }

      @media (min-height: 1175px) {
        .icon-gdpr {
          font-size: 24px;
        }

        .unityads-logo {
          height: 24px;
        }
      }

      @media (min-height: 0) {
        font-size: $default-px-size * .35;
      }

      @media (min-height: 250px) {
        font-size: $default-px-size * .5;
      }

      @media (min-height: 320px) {
        font-size: $default-px-size * .6;
      }

      @media (min-height: 380px) {
        font-size: $default-px-size * .65;
      }

      @media (min-height: 460px) {
        font-size: $default-px-size * .85;
      }

      @media (min-height: 560px) {
        font-size: $default-px-size * 1;
      }

      @media (min-height: 600px) {
        font-size: $default-px-size * 1.1;
      }

      @media (min-height: 680px) {
        font-size: $default-px-size * 1.2;
      }

      @media (min-height: 780px) {
        font-size: $default-px-size * 1.4;
      }

      @media (min-height: 980px) {
        font-size: $default-px-size * 1.6;
      }

      @media (min-height: 1050px) {
        font-size: $default-px-size * 1.7;
      }

      @media (min-height: 1175px) {
        font-size: $default-px-size * 2;
      }

      @media (min-height: 1375px) {
          font-size: $default-px-size * 2.4;
      }

      @media (min-height: 1675px) {
        font-size: $default-px-size * 2.8;
      }

      @media (min-height: 1975px) {
        font-size: $default-px-size * 3.2;
      }

      @media (min-height: 2275px) {
        font-size: $default-px-size * 3.8;
      }

      @media (min-height: 2575px) {
        font-size: $default-px-size * 4.4;
      }

      @media (min-height: 2875px) {
        font-size: $default-px-size * 5;
      }

      @media (min-height: 3475px) {
        font-size: $default-px-size * 5.8;
      }
    }

    @media (orientation: landscape) {
      @media (max-width: 510px) {
        .icon-gdpr {
          font-size: 14px;
        }

        .unityads-logo {
          height: 14px;
        }
      }

      @media (min-width: 200px) {
        font-size: $default-px-size * .7;
      }

      @media (min-width: 320px) {
        font-size: $default-px-size * .8;
      }

      @media (min-width: 460px) {
        font-size: $default-px-size * .95;
      }

      @media (min-width: 580px) {
        font-size: $default-px-size * 1.2;
      }

      @media (min-width: 760px) {
        font-size: $default-px-size * 1.4;
      }

      @media (min-width: 960px) {
        font-size: $default-px-size * 1.6;
      }

      @media (min-width: 1160px) {
        font-size: $default-px-size * 2.2;
      }

      @media (min-width: 1460px) {
        font-size: $default-px-size * 2.8;
      }

      @media (min-width: 1760px) {
        font-size: $default-px-size * 3.8;
      }

      @media (min-width: 2260px) {
        font-size: $default-px-size * 4.6;
      }
    }
  }
}

$redesigned-end-screen-mixin();

/* iPhone X, XR and XS Max fixes */
@media only screen and (device-width : 375px) and (device-height : 812px) and (-webkit-device-pixel-ratio : 3),
only screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2),
only screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) {

  html.redesigned-performance-end-screen .ios-portrait #privacy {
    top: 0;
    padding-top: env(safe-area-inset-top);
  }

  html.redesigned-performance-end-screen .landscape #privacy {
    left: 0;
    width: 100%;
  }

  body.iphone #redesigned-end-screen {
    .pop-up-container {
      margin-top: 1em;
      width: calc(100% - 2em);
      height: calc(100% - env(safe-area-inset-bottom) - env(safe-area-inset-top) - 1em);
    }

    .btn-close-region {
      top: env(safe-area-inset-top);
    }
  }

  .performance-end-screen body {
    &.ios-landscape-right #redesigned-end-screen {
      .bottom-container {
        right: calc(env(safe-area-inset-right) + 1em);
        margin-bottom: calc(env(safe-area-inset-bottom) - .5em);
        width: calc(50% - 2em);
      }
    }

    &.ios-landscape-left #redesigned-end-screen {
      width: calc(100% - 2em);

      .pop-up-container {
        width: calc(100% - 2em - env(safe-area-inset-right));
      }

      .bottom-container {
        right: calc(env(safe-area-inset-right) + 1em);
        width: calc(50% - env(safe-area-inset-right) - 1em);

        .privacy-button {
          right: 0;
        }
      }
    }
  }
}

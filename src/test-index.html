<!DOCTYPE html>
<html lang="en">
<head>
    <title>Unity Ads WebView</title>

    <meta charset="utf-8"/>
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
    <meta name="format-detection" content="telephone=no"/>

    <script type="text/javascript">{ES6_PROMISE}</script>
    <script type="text/javascript">{SYSTEM_JS}</script>
    <script>
        var origin = 'http://localhost:8000/';
        if(location.search.length > 0 && location.search.indexOf('?') !== -1) {
            var queryString = location.search.split('?')[1].split('&');
            var queryParams = {};
            for(i = 0; i < queryString.length; i++) {
                var param = queryString[i].split('=');
                queryParams[param[0]] = param[1];
            }
            if('origin' in queryParams) {
                var decodedOrigin = decodeURIComponent(queryParams['origin']);
                origin = decodedOrigin.substring(0, decodedOrigin.lastIndexOf('/') + 1);
            }
        }

        var style = document.createElement('link');
        style.rel = 'stylesheet';
        style.href = origin + 'css/main.css';
        document.head.appendChild(style);

        var config = {
            baseURL: origin + 'js',
            map: {
                'es6-promise': '@empty',
                text: origin + 'vendor/systemjs-plugin-text/text.js',
                mocha: origin + 'vendor/mocha.js',
                chai: origin + 'vendor/chai.js',
                sinon: origin + 'vendor/sinon.js',
                text: origin + 'vendor/text.js',
                long: origin + 'vendor/long.js',
                'protobufjs/minimal': origin + 'vendor/protobuf.js',
                reporter: origin + 'vendor/reporter.js'
            },
            meta: {
                'mocha': {
                    format: 'global'
                },
                '*.html': {
                    loader: 'text'
                },
                '*.xml': {
                    loader: 'text'
                },
                '*.json': {
                    loader: 'text'
                },
                '*.css': {
                    loader: 'text'
                }
            },
            packages: {},
            paths: {
                '*.html': origin + '*.html',
                '*.xml': origin + '*.xml',
                '*.json': origin + '*.json',
                '*.css': './*.css'
            }
        };
        config.packages[origin] = {
            defaultExtension: 'js'
        };
        System.config(config);
        Promise.all([
            System.import('mocha'),
            System.import('reporter')
        ]).then(function(results) {
            window.runner = new Mocha({
                ui: 'bdd',
                checkLeaks: true,
                fullTrace: true,
                globals: ['nativebridge', 'webviewbridge'],
                reporter: results[1]
            });
            window.runner.suite.emit('pre-require', window, 'global-mocha-context', window.runner);
            System.import(origin + 'runner');
        });
    </script>
</head>
<body></body>
</html>
